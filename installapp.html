<!DOCTYPE html>
<html>
  <head>
    <title id="webtitle">JSPC - Install Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.0/css/bulma.min.css"
      integrity="sha512-ADrqa2PY1TZtb/MoLZIZu/Z/LlPaWQeDMBV73EMwjGam43/JJ5fqW38Rq8LJOVGCDfrJeOMS3Q/wRUVzW5DkjQ=="
      crossorigin="anonymous"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/jquery.terminal/js/jquery.terminal.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/jquery.terminal/css/jquery.terminal.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/BrowserFS/2.0.0/browserfs.min.js"
      integrity="sha512-mz0EI+Ay1uIJP7rZEX8C/JlTAcHRIQ8Sny4vxmmj8MSzDJgG9NxxY2pUmOGv1lO7imFIFMyjjCzEXEywNgaUdQ=="
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/js-polyfills/keyboard.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jcubic/static/js/wcwidth.js"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const appjson = urlParams.get("appurl");
    </script>
  </head>
  <body>
    <script>
      var getJSON = function(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.responseType = "json";
        xhr.onload = function() {
          var status = xhr.status;
          if (status === 200) {
            callback(null, xhr.response);
          } else {
            callback(status, xhr.response);
          }
        };
        xhr.send();
      };

      getJSON(appjson, function(err, data) {
        if (err !== null) {
          alert("Something went wrong: " + err);
        } else {
          appname = data.appname;
          appdesc = data.appdesc;
          appurls = data.appurls;
          startupapp = data.startupapp;
          appsetupurl = data.appsetupurl;
          appdisplayname = data.appdisplayname;
        }
      });

      function installapp() {
        getJSON(appjson, function(err, data) {
          if (err !== null) {
            alert("Something went wrong: " + err);
          } else {
            //Get JSON Data
            appname = data.appname;
            appdesc = data.appdesc;
            appurls = data.appurls;
            //startupapp = data.startupapp;
            appsetupurl = data.appsetupurl;

            //Drop URLS to LocalStorage
            var appurlsjson = JSON.stringify(data.appurls);
            localStorage.setItem(appname, JSON.stringify(data.appurls));

            //Drop The Installed App To LocalStorage
            var installedapps2 = localStorage.getItem("installedapps");
            var installedappsparced = JSON.parse(installedapps2);
            installedappsparced.push(appname);
            localStorage.setItem(
              "installedapps",
              JSON.stringify(installedappsparced)
            );
            //Run The Setup Script
            if (data.hassetupscript == true) {
              try {
                var btn = document.createElement("script");
                btn.setAttribute("src", data.appsetupurl);
                document.head.appendChild(btn);
              } catch (err) {
                alert(
                  "The setup script of app name: " +
                    data.appdisplayname +
                    "\nHas crashed, We will exit the installation now."
                );
              }
              alert(
                "The installation of app name: " +
                  data.appdisplayname +
                  "\nHas completed and is now ready for use."
              );
            } else {
              alert(
                "The installation of app name: " +
                  data.appdisplayname +
                  "\nHas completed and is now ready for use."
              );
            }
          }
        });
      }
    </script>
    <div id="AppDIV">
      <section class="section">
        <div class="container">
          <h1 class="title">
            Install App
          </h1>
          <p class="subtitle" id="installdesc">
            Your about to install {[appdisplayname]}
          </p>
        </div>
        <section class="section">
          <div class="container">
            <h2 class="paragraph">
              <p>
                JSPC is a virtual computer built with javascript and runs in
                your<br />
                browser. It's not technicaly a VM, but it does emulate a
                computer.<br />
                The operating system that is used is JSOS the javascript
                operating<br />
                system.
              </p>
            </h2>
          </div>
        </section>
      </section>
      <script>
      getJSON(appjson, function(err, data) {
        if (err !== null) {
          alert("Something went wrong: " + err);
        } else {
          appname = data.appname;
          appdesc = data.appdesc;
          appurls = data.appurls;
          startupapp = data.startupapp;
          appsetupurl = data.appsetupurl;
          appdisplayname = data.appdisplayname;
          document.getElementById("installdesc").innerHTML = "Your about to install: " + data.appdisplayname
        }
      });
        </script>
    </div>
  </body>
</html>
